{"version":3,"sources":["index.js"],"names":["ANIMATE_LINES","SETUP_ZOOM_AND_BG","n_lines","parseInt","n_entries","mult","d3","select","selectAll","remove","create_data","start_at","data","i","line","j","offset","shuffle","last","length","push","means","reducer","accumulator","currentValue","totals","reduce","all_means","margin","top","right","bottom","left","width","style","height","xScale","scaleLinear","range","yScale","color","scaleOrdinal","schemeCategory10","domain","xAxis","axisBottom","scale","yAxis","axisLeft","curve","curveStep","x","d","y","svg","attr","append","zoomed","console","log","event","transform","call","zoom","scaleExtent","on","extent","flat","animate_to_mean","text","lines","enter","resize","animate","ticks","Math","max","has_run","is_showing_mean","data_to_use","transition","duration","ease","easeExp","easeBounce","delay","repeat","active","styleTween","tweenDash","easeLinear","Debouncer","lookup","identifier","timer_id","clearTimeout","ms","cb","cancel","new_timer_id","setTimeout","debounce","window","set","l","getTotalLength","interpolateString","t","tweenBack"],"mappings":"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","file":"randomwalks.e31bb0bc.map","sourceRoot":"..","sourcesContent":["// https://bl.ocks.org/josiahdavis/7a02e811360ff00c4eef\n\nlet ANIMATE_LINES = false;\n// ANIMATE_LINES = true;\n\nlet SETUP_ZOOM_AND_BG = false;\nlet n_lines = parseInt(process.env.N_LINES) || 200;\nlet n_entries = parseInt(process.env.N_ENTRIES) || 150;\n// let mult = parseInt(process.env.MULT) || 0; // 1 gives us touching grid, 2 gives us spacing  stairs, 0 gives us a tree\nlet mult = parseInt(process.env.MULT) || 0.01; // 1 gives us touching grid, 2 gives us spacing  stairs, 0 gives us a tree\n// let n_lines = 3;\n\n// console.log(process.env.DB_HOST);\n// reset for hmr in dev\nd3.select(\"svg\")\n  .selectAll(\"*\")\n  .remove();\n\n// console.log(process.env.MULT)\n// generate my data\nfunction create_data() {\n  let start_at = 0;\n  // let start_at = -(n_lines / 2);\n  // console.log(start_at);\n  // let start_at = -5;\n  let data = [];\n  for (var i = start_at; i < n_lines + start_at; i++) {\n    // they all now just start at 0, much simple\n    // possibly add back in `mult` in the rendering or scale\n    let line = [0];\n    //better\n    // let line = [i * mult];\n    // let line = d3.range(-n_lines / 2 + i * mult, n_lines / 2 + i * mult);\n    // for simpler debugging\n    // let line = d3.range(-5 + i, 5 + i);\n    for (var j = 0; j < n_entries - 1; j++) {\n      // flip a coin\n      let offset = d3.shuffle([-1, 1])[0];\n      // get the the previous value\n      let last = line[line.length - 1];\n      // add the previous value to our new coin flip and push it to the line's array\n      line.push(last + offset);\n    }\n    data.push(line);\n  }\n\n  return data;\n}\n\nlet data = create_data();\nlet means = [];\n// console.log(data);\nfor (var j = 0; j < n_entries; j++) {\n  const reducer = (accumulator, currentValue) => accumulator + currentValue[j];\n  let totals = data.reduce(reducer, 0);\n  means.push(totals / n_lines);\n}\n\nlet all_means = [];\nfor (var i = 0; i < n_lines; i++) {\n  all_means.push(means);\n}\n// console.log(all_means);\n// console.log(means.length);\n\n// const csv_file_path = require(\"./giniLine.csv\");\n// Define margins\nvar margin = { top: 20, right: 0, bottom: 30, left: 50 },\n  width =\n    parseInt(d3.select(\"svg\").style(\"width\")) - margin.left - margin.right,\n  height =\n    parseInt(d3.select(\"svg\").style(\"height\")) - margin.top - margin.bottom;\n\n// Define date parser\n// var parseDate = d3.timeParse(\"%Y-%m-%d %H:%M:%S\");\n\n// Define scales\n// var xScale = d3.scaleTime().range([0, width]);\nvar xScale = d3.scaleLinear().range([0, width]);\nvar yScale = d3.scaleLinear().range([height, 0]);\nvar color = d3\n  .scaleOrdinal()\n  .range(d3.schemeCategory10)\n  .domain([0, data.length]);\n\n// Define axes\nvar xAxis = d3.axisBottom().scale(xScale);\nvar yAxis = d3.axisLeft().scale(yScale);\n\n// Define lines\nvar line = d3\n  .line()\n  .curve(d3.curveStep)\n  // .curve(d3.curveStepAfter)\n  // .curve(d3.curveMonotoneX)\n  .x(function(d, i) {\n    return xScale(i);\n    // return xScale(d[\"date\"]);\n  })\n  .y(function(d, i) {\n    return yScale(d);\n    // return yScale(d[\"concentration\"]);\n  });\n\n// Define svg canvas\nvar svg = d3\n  .select(\"svg\")\n  .attr(\"width\", width + margin.left + margin.right)\n  .attr(\"height\", height + margin.top + margin.bottom)\n  .append(\"g\")\n  .attr(\"transform\", \"translate(\" + margin.left + \",\" + margin.top + \")\");\n\nsvg = svg.append(\"g\").attr(\"id\", \"graph\");\n\nif (SETUP_ZOOM_AND_BG) {\n  svg\n    .append(\"rect\")\n    .attr(\"width\", width + margin.left + margin.right)\n    .attr(\"height\", height + margin.top + margin.bottom);\n  function zoomed() {\n    console.log(\"zoomm?\");\n    d3.select(\"g#graph \").attr(\"transform\", d3.event.transform);\n  }\n  d3.select(\"g#graph \").call(\n    d3\n      .zoom()\n      .scaleExtent([1 / 2, 4])\n      .on(\"zoom\", zoomed)\n  );\n}\n\n// Set the domain of the axes\n// hacky, assumes they're all the same length, we use the first one XXX\nxScale.domain([0, data[0].length]);\n\n// this fits them all\nyScale.domain(\n  d3.extent(data.flat(), function(d, i) {\n    return d;\n  })\n);\n\n//  for close up debug\n// xScale.domain([0, data[0].length / 2]);\n// yScale.domain([0, 25]);\n// d3.select(\"body\").on(\"click\", animate);\nd3.select(\"body\").on(\"click\", animate_to_mean);\n// Place the axes on the chart\nsvg\n  .append(\"g\")\n  .attr(\"class\", \"x axis\")\n  .attr(\"transform\", \"translate(0,\" + height + \")\")\n  .call(xAxis)\n  .append(\"text\")\n  .attr(\"class\", \"label\")\n  .attr(\"y\", 15)\n  .attr(\"x\", 55)\n  .attr(\"dy\", \".71em\")\n  // .attr(\"dx\", \".71em\")\n  .style(\"text-anchor\", \"beginning\")\n  .text(\"time\");\n\nsvg\n  .append(\"g\")\n  .attr(\"class\", \"y axis\")\n  .call(yAxis)\n  .append(\"text\")\n  .attr(\"class\", \"label\")\n  .attr(\"y\", 25)\n  .attr(\"x\", -35)\n  .attr(\"dy\", \".71em\")\n  // .attr(\"dx\", \".71em\")\n  .style(\"text-anchor\", \"beginning\")\n  .text(\"Y\");\n\n// console.log(data);\nvar lines = svg\n  .selectAll(\".trend_g\")\n  .data(data)\n  .enter()\n  .append(\"g\")\n  .attr(\"class\", \"trend_g\");\n\nlines\n  .append(\"path\")\n  .attr(\"class\", \"line\")\n  .attr(\"d\", function(d) {\n    // console.log(d);\n    return line(d);\n  })\n  .style(\"stroke\", function(d, i) {\n    return color(i);\n    // return \"black\";\n  });\n\n// console.log(JSON.stringify(d3.values(concentrations), null, 2)) // to view the structure\n// console.log(d3.values(concentrations)); // to view the structure\n// console.log(concentrations);\n// console.log(concentrations.map(function()))\n\n// });\n\n// Define responsive behavior\nfunction resize() {\n  var width =\n      parseInt(d3.select(\"svg\").style(\"width\")) - margin.left - margin.right,\n    height =\n      parseInt(d3.select(\"svg\").style(\"height\")) - margin.top - margin.bottom;\n\n  // Update the range of the scale with new width/height\n  xScale.range([0, width]);\n  yScale.range([height, 0]);\n\n  // Update the axis and text with the new scale\n  svg\n    .select(\".x.axis\")\n    .attr(\"transform\", \"translate(0,\" + height + \")\")\n    .call(xAxis);\n\n  svg.select(\".y.axis\").call(yAxis);\n\n  // Force D3 to recalculate and update the line\n\n  svg.selectAll(\".line\").attr(\"d\", function(d) {\n    return line(d);\n  });\n  // and do our animation\n\n  if (ANIMATE_LINES) {\n    animate();\n  }\n\n  // .on(\"start\", repeat);\n\n  // Update the tick marks\n  xAxis.ticks(Math.max(width / 75, 2));\n  yAxis.ticks(Math.max(height / 50, 2));\n}\n\n// hacky flag\nlet has_run = false;\nlet is_showing_mean = false;\n\nfunction animate_to_mean() {\n  console.log(\"animate_to_mean\");\n  let data_to_use = !is_showing_mean ? all_means : data;\n  is_showing_mean = !is_showing_mean;\n\n  let lines = svg\n    .selectAll(\".trend_g\")\n    .data(data_to_use)\n    .transition()\n    .duration(2000)\n    // .ease(d3.easeExp);\n    // .ease(d3.easeElastic);\n    .ease(is_showing_mean ? d3.easeExp : d3.easeBounce);\n\n  // .enter()\n  // .append(\"g\")\n  // .attr(\"class\", \"trend_g\");\n\n  lines\n    // .append(\"path\")\n    .select(\"path\")\n    .attr(\"d\", function(d) {\n      // console.log(d);\n      return line(d);\n    });\n  // .transition();\n}\nfunction animate() {\n  if (has_run) {\n    return;\n  }\n  console.log(\"animating!\");\n  has_run = true;\n  svg\n    .selectAll(\".line\")\n    .attr(\"stroke-dasharray\", \"0 100000\")\n    .transition()\n    .delay((d, i) => i * 1000)\n    .duration(20000)\n    .on(\"start\", function repeat() {\n      d3.active(this)\n        .styleTween(\"stroke-dasharray\", tweenDash)\n        .ease(d3.easeLinear)\n        .transition();\n    });\n}\n\nclass Debouncer {\n  constructor() {\n    this.lookup = {};\n  }\n  cancel(identifier) {\n    let timer_id = this.lookup[identifier];\n    if (timer_id) {\n      clearTimeout(timer_id);\n      delete this.lookup[timer_id];\n    }\n  }\n  set(identifier, ms, cb) {\n    this.cancel(identifier);\n    let new_timer_id = setTimeout(cb, ms);\n    this.lookup[identifier] = new_timer_id;\n  }\n}\n\nlet debounce = new Debouncer();\n\n// Call the resize function whenever a resize event occurs\nd3.select(window).on(\"resize\", () => debounce.set(\"resized\", 450, resize));\n// need debounce!  XXX\n\n// Call the resize function\nresize();\n\nfunction tweenDash() {\n  var l = this.getTotalLength(),\n    i = d3.interpolateString(\"0,\" + l, l + \",\" + l);\n  return function(t) {\n    return i(t);\n  };\n}\n\nfunction tweenBack() {\n  var l = this.getTotalLength(),\n    i = d3.interpolateString(l + \",0\", \"0,\" + l);\n  return function(t) {\n    return i(t);\n  };\n}\n"]}